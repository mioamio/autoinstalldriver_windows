![](https://raw.githubusercontent.com/mioamio/autoinstalldriver_windows/main/image.jpg)
[![Windows](https://badgen.net/badge/icon/windows?icon=windows&label)](https://microsoft.com/windows/)
![Terminal](https://badgen.net/badge/icon/terminal?icon=terminal&label)
[![Views](https://views.igorkowalczyk.dev/api/badge/mioamio?repo=autoinstalldriver_windows&label=Views&style=classic)](https://github.com/mioamio/autoinstalldriver_windows/graphs/traffic)
[![License: MIT](https://img.shields.io/github/license/mioamio/autoinstalldriver_windows?style=flat-square)](https://github.com/mioamio/autoinstalldriver_windows/blob/main/LICENSE)
[![Telegram](https://badgen.net/badge/Telegram/me/2CA5E0)](https://t.me/topvselennaya)
[![Telegram](https://badgen.net/badge/Telegram/channel/2CA5E0)](https://t.me/scriptsautomation)


# PowerShell: Автоматический установщик драйверов

Cкрипт предназначен для автоматического поиска и установки (заранее добавленных в папку) драйверов для устройств с проблемами (например, с кодом ошибки 28 в Диспетчере устройств) или для видеоадаптеров, работающих на базовом драйвере Microsoft.

## Возможности

*   **Автоматический запрос прав администратора:** Скрипт проверяет наличие прав администратора и, при необходимости, пытается перезапуститься с повышенными привилегиями.
*   **Поиск проблемных устройств:**
    *   Идентифицирует устройства с кодом ошибки Configuration Manager 28 (драйвер не установлен).
    *   Идентифицирует видеоадаптеры, использующие "Базовый видеоадаптер Microsoft" (или "Microsoft Basic Display Adapter").
*   **Поиск драйверов:**
    *   По умолчанию ищет директорию с именем `ADrivers` на дисках C:, D:, E: и т.д. (список дисков можно настроить в скрипте, как и основную директорию с драйверами)
    *   Рекурсивно собирает все `*.inf` файлы из найденных директорий `ADrivers`.
*   **Эффективное кэширование INF-файлов:**
    *   Считывает содержимое всех найденных INF-файлов в память для ускорения поиска.
    *   Использует параллельную обработку для кэширования на многоядерных системах (для PowerShell 7+ используется `ForEach-Object -Parallel`, для PowerShell 5.1 - пул рабочих пространств).
*   **Сопоставление драйверов:**
    *   Для каждого проблемного устройства ищет совпадения его Hardware ID или Compatible ID внутри кэшированных INF-файлов.
*   **Установка драйверов:**
    *   Использует `pnputil.exe /add-driver <путь_к_inf> /install` для установки подходящего драйвера.
    *   Проверяет код возврата `pnputil.exe` (0 - успех, 3010 - успех, требуется перезагрузка).
    *   Повторно запрашивает информацию об устройстве для проверки статуса после установки.
*   **Индикация процесса:** Отображает анимированный спиннер во время длительных операций.
*   **Подробный отчет:** Выводит информацию о найденных устройствах, предпринятых попытках установки, успешно установленных драйверах, ошибках и устройствах, для которых драйверы не были найдены. Сообщает о необходимости перезагрузки.

## Требования

*   **Операционная система:** Windows.
*   **PowerShell:** Версия 5.1 или новее (для полной функциональности параллельной обработки рекомендуется PowerShell 7+).
*   **Права администратора:** Необходимы для установки драйверов (скрипт попытается получить их автоматически).
*   **Драйверы:** Распакованные пакеты драйверов (содержащие `.inf`, `.sys`, `.cat` и другие файлы) должны быть размещены в специальных директориях.

## Подготовка драйверов

Это самый важный шаг для успешной работы скрипта:

1.  **Создайте директорию `ADrivers`**  на одном или нескольких логических дисках (например, `C:\ADrivers`, `D:\ADrivers`). Скрипт будет искать драйверы именно в этой папке.
2.  **Скачайте необходимые пакеты драйверов** для оборудования, на которых будете работать.
3.  **Распакуйте архивы с драйверами** так, чтобы каждая папка с драйвером (содержащая `.inf` файл) находилась внутри одной из директорий `ADrivers`.

    **Пример структуры:**

    ```
    D:\ADrivers\
    ├── Realtek_Audio_Driver\
    │   ├── HDXRT.inf
    │   ├── RTKVHD64.sys
    │   └── ... (другие файлы драйвера)
    ├── Intel_Chipset_Driver\
    │   ├── ichipset.inf
    │   └── ...
    └── NVIDIA_Graphics_Driver\
        ├── nv_disp.inf
        ├── nvdia.dll
        └── ...
    ```

    **Неправильно:** `D:\ADrivers\Realtek_Audio_Driver.zip` (архивы не будут обработаны)
    
    **Правильно:** `D:\ADrivers\Папка_с_распакованным_драйвером_Realtek\`

## Как использовать

1.  **Скачайте скрипт** <https://github.com/mioamio/autoinstalldriver_windows/releases>
2.  **Подготовьте драйверы** как описано в разделе "Подготовка драйверов".
3.  **Запустите скрипт:**
    *   Запустите файл `startme.bat`.
4.  Если скрипт запущен без прав администратора, он попытается перезапуститься с ними. Подтвердите запрос UAC.
5.  Скрипт начнет поиск проблемных устройств и подходящих драйверов. Дождитесь завершения.
6.  По окончании работы скрипт выведет сводку о результатах. Обратите внимание на сообщения об ошибках или необходимости перезагрузки.

## Важные замечания

*   **Нет гарантий:** Скрипт автоматизирует процесс, но не гарантирует нахождение и установку всех необходимых драйверов. Успех зависит от наличия подходящих `.inf` файлов в указанных директориях и корректности самих драйверов.
*   **Логи `pnputil`:** Если `pnputil.exe` сообщает об ошибке установки, подробную информацию можно найти в лог-файле `C:\Windows\INF\setupapi.dev.log`.
*   **Перезагрузка:** Для некоторых драйверов может потребоваться перезагрузка системы для завершения установки. Скрипт сообщит об этом.
*   **Резервное копирование:** Перед запуском скриптов, вносящих изменения в систему (включая установку драйверов), рекомендуется создать точку восстановления системы или резервную копию важных данных.

## Для продвинутых пользователей

*   **Изменение путей поиска драйверов:** В начале скрипта можно отредактировать массив `$driveLetters`, чтобы изменить список дисков, на которых будет осуществляться поиск папки `ADrivers`.
    ```powershell
    $driveLetters = 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K'
    # Можно изменить, например, на:
    # $driveLetters = 'D', 'X'
    ```

## Дисклеймер

Используйте этот скрипт на свой страх и риск. Автор не несет ответственности за любые возможные проблемы, возникшие в результате использования данного скрипта.
---
![Безымянный](https://github.com/user-attachments/assets/2caf2ad0-c5db-4a2d-902f-e6e91be113ce)

---
 ## Идея: Автоматизация рутинной задачи установки драйверов — особенно удобно для системных администраторов или при частой переустановке системы.
---
